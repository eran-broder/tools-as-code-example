
# Tools as Code Example

This is a simple example of using tools in a code environment.

## Setup

1. **Install dependencies:**

   ```bash
   npm install
   ```

2. **Set your `ANTHROPIC_API_KEY` in the `.env` file.**

3. **Run the example:**

   ```bash
   npx ts-node src/index.ts
   ```

## What Is the Idea?

### How to Save BIG on Tokens When Running Tool-Based Agents

For the past several weeks, I have completely abandoned traditional `tool_calls` in favor of a new method.

Suppose we have two tools:

- `getCurrentUserId(): string` &rarr; **Returns the current user ID.**
- `getUserPhoneNumber(input: { userId: string }): string` &rarr; **Returns the phone number of a user.**

And we give the agent the following task:

> **"What is the phone number of the current user?"**

#### Traditional Approach

A simple agent using these tools will "charge" you like this:

##### ⏰ Step 1:

**Input:**

- 💰 The task.

**Output:**

- 💰 Call the tool to get the user ID.

##### ⏰ Step 2:

- 💰 Tokens for the task.
- 💰 Call the tool to get the user ID.
- 💰 The user ID.
- 📤 Call the tool to get the phone number.

##### ⏰ Step 3:
- 💰 Tokens for the task.
- 💰 Call the tool to get the user ID.
- 💰 The user ID.
- 💰 Call the tool to get the phone number.
- 📤 The phone number (but as a tool result).

##### ⏰ Step 4:

**Input:**

- 💰 Tokens for the task.
- 💰 Call the tool to get the user ID.
- 💰 The user ID.
- 💰 Call the tool to get the phone number.
- 💰 The phone number (but as a tool result).
- 📤 A nice message with the phone number.

**Time Cost:** 4× ⏰

**Total Token Cost:** 17× 💰

## New Approach

##### ⏰ Step 1:

**Input:**

- 💰 The task.

**Output:**

- 💰 Run the code that takes care of everything.

**Time Cost:** 1× ⏰

**Total Token Cost:** 2× 💰

### How Does It Work?

Instead of an array of tools that looks like this:

```javascript
[getCurrentUserTool, getUserPhoneNumberTool]
```

We use:

```javascript
wrapWithExecutionScope([getCurrentUserTool, getUserPhoneNumberTool]);
```

And our tool will run the following code that was generated by the LLM itself:

```javascript
const userId = await tools.getCurrentUserId();
const phoneNumber = await tools.getUserPhoneNumber({ userId });
await tools.provideAnswer({
  answer:
    phoneNumber === null
      ? "No phone number found for the current user"
      : `The phone number is: ${phoneNumber}`,
});
return phoneNumber;
```
